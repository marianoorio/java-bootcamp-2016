CREATE DATABASE high_school;
USE DATABASE high_school;

-- Creation of students table
CREATE TABLE IF NOT EXISTS students
(
	id_student INT(8) UNSIGNED NOT NULL PRIMARY KEY, -- Estudents unique identifier MAX_VALUE = 99999999
	first_name VARCHAR(20) NOT NULL, -- Estudents first name
	last_name VARCHAR(20) NOT NULL, -- Estudents last name
	birthdate DATE NOT NULL, -- Estudents date of birth
	registration_number INT(6) UNSIGNED NOT NULL -- Estudents registration number MAX_VALUE = 999999
	#PRIMARY KEY (idStudent) OR id_student INT(8) UNSIGNED NOT NULL PRIMARY KEY WICH IS BETTER???
);

-- Creation students table verification
--SHOW TABLES; 
--DESCRIBE students;

-- Creation of teachers table

CREATE TABLE IF NOT EXISTS teachers
(
	id_teacher INT(8) UNSIGNED NOT NULL PRIMARY KEY, -- teacher unique identifier MAX_VALUE = 99999999
	first_name VARCHAR(20) NOT NULL, -- teacher first name
	last_name VARCHAR(20) NOT NULL, -- teacher last name
	birthdate DATE NOT NULL -- teacher date of birth
);

--Creation teachers table verification
--SHOW TABLES;
--DESCRIBE teachers;

CREATE TABLE IF NOT EXISTS courses
(
	id_course INT(5) UNSIGNED NOT NULL PRIMARY KEY, -- course unique identifier MAX_VALUE = 99999
	course_name VARCHAR(20) NOT NULL,  -- course name
	week_hours INT(3) UNSIGNED NOT NULL DEFAULT 0, -- course duration(hours) in a week
	id_teacher INT(8) UNSIGNED DEFAULT NULL, -- id of teacher assigned to the course
	FOREIGN KEY (id_teacher) REFERENCES teachers(id_teacher) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS courses_schedules
(
	id_course INT(5) UNSIGNED NOT NULL, -- 
	day_of_week INT(1) UNSIGNED NOT NULL,
	start_time TIME NOT NULL,
	end_time TIME NOT NULL,
	PRIMARY KEY (id_course, day_of_week, start_time, end_time),
	FOREIGN KEY (id_course) REFERENCES courses(id_course), 
	CHECK (day_of_week < 7)
);

CREATE TABLE IF NOT EXISTS courses_students
(
	id_course INT(5) UNSIGNED NOT NULL,
	id_student INT(8) UNSIGNED NOT NULL,
	PRIMARY KEY (id_course, id_student),
	FOREIGN KEY (id_course) REFERENCES courses(id_course),
	FOREIGN KEY (id_student) REFERENCES students(id_student)
);

CREATE TABLE IF NOT EXISTS courses_students_exams
(
	id_course INT(5) UNSIGNED NOT NULL,
	id_student INT(8) UNSIGNED NOT NULL,
	exam_type ENUM('parcial_1','parcial_2','parcial_3','final') NOT NULL,	
	note FLOAT(4,2) UNSIGNED NOT NULL,	
	PRIMARY KEY (id_course, id_student, exam_type),
	FOREIGN KEY (id_course) REFERENCES courses(id_course),
	FOREIGN KEY (id_student) REFERENCES students(id_student),
	CHECK (note <= 10)
);
